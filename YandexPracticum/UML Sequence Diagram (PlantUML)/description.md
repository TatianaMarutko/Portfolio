**Кейс**

*Разработка сайта агрегатора для покупки авиабилетов*

**Задача** составить диаграмму последовательности для следующего процесса взаимодействия:

1. Клиент входит на сайт-агрегатор для поиска и покупки авиабилетов.
2. Поиск осуществляется в трёх авиакомпаниях:
   - «Добролёт»
   - «Чистое небо»
   - «Авионика»

Каждая авиакомпания предоставляет API, откуда можно получить данные о доступных авиабилетах. Агрегатор собирает данные по запросу пользователя из предоставленных API, и данные запрашиваются параллельно.

3. После сбора данных, агрегатор отображает результат клиенту. Клиент выбирает один из предложенных вариантов и бронирует билет.
4. Агрегатор обращается в API авиакомпании для создания брони билета. Бронь создается на 15 минут.
5.После бронирования клиент должен произвести оплату на сайте агрегатора через сторонний платёжный сервис «Лёгкие платежи». Клиент заполняет форму оплаты, которую предоставляет сервис API «Лёгкие платежи».
6. Клиент вводит данные и после оплачивает бронь. Платёжный сервис связывается с API «Банк эквайер» для инициации оплаты.
7. «Банк эквайер» обращается в API «Банк эмитент» для запроса перевода денег. После подтверждения перевода, «Банк эквайер» передаёт информацию об оплате в платёжный сервис «Лёгкие платежи» и отправляет смс-уведомление клиенту об оплате.
8. Сервис «Лёгкие платежи» передает информацию на сайт-агрегатор.
9. Сайт передаёт информацию об оплате в API авиакомпании, которую выбрал клиент.
10. Авиакомпания получает подтверждение оплаты, затем закрывает бронь авиабилета и привязывает оплаченный авиабилет к клиенту. После этого информация о приобретённом авиабилете передаётся на сайт-агрегатор.
11. Клиент видит информацию о билете.
12. Все взаимодействия осуществляются в стиле REST.

**Результаты работы:** [sequenceUMLPlanet.png](https://github.com/TatianaMarutko/Portfolio/blob/main/YandexPracticum/UML%20Sequence%20Diagram%20(PlantUML)/sequenceUMLPlanet.png)

Для выполнения задачи я воспользовалась PlantUML:

@startuml

actor Клиент as kl order 1

participant "Сайт агрегатор" as web order 2

participant "API а/к Доборлет" as dobr order 3

participant "API а/к Чистое небо" as sky order 4

participant "API а/к Авионика" as avia order 5

participant "API сервиса Легкие платежи" as pay order 6

actor "Банк-эквайер" as acquirer order 7

actor "Банк-эмитет" as emitter order 8


kl->web++: GET 1.Войти на сайт

kl->web: GET 2. Запросить авиабилеты по параметрам поиска

par

web->>dobr: GET 3.1 Получить данные о доступных авиабилетах

web++

dobr-->web: Данные

web->>sky: GET 3.2 Получить данные о доступных авиабилетах

sky-->web: Данные

web->>avia: GET 3.3 Получить данные о доступных авиабилетах 

avia-->web: Данные

web--

end par

web-->kl: Авиабилеты по запросу

kl->web: POST 4.Забронировать авиабилет

web->sky++: POST 5. Забронировать выбранный авиабилет

sky->sky++: 6. Создание брони [T = 15 мин]

sky-->web: Ответ Информация о брони билета

web-->kl: Билет забронирован на 15 мин

web->pay++: GET 7. Запросить форму для оплаты

pay-->web: Форма оплаты

pay--

web-->kl: Форма оплаты

kl->web: POST 8. Оплатить авиабилет

web->pay++: POST 9. Передать данные для оплаты

pay->acquirer++: POST 10. Передать данные для оплаты

acquirer->emitter++: GET 11. Запросить денежные средства

emitter-->acquirer--: Оплата произведена

acquirer-->pay: Оплата подтверждена

pay-->web: Данные об оплате

pay--

emitter->>kl: 12. СМС о переводе денег

web->sky: POST 13. Подверждение оплаты

sky->sky--: 14. Завершение брони

sky->web: POST 15. Данные авиабилета

sky--

web-->kl: Авиабилет

web--

@enduml
